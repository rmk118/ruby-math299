<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ruby Krasnow">

<title>Math 299 - Inference &amp; Diagnostics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Math 299</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hw" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">HW</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hw">    
        <li>
    <a class="dropdown-item" href="../HW/hw_01_intro_to_markdown.html" rel="" target="">
 <span class="dropdown-text">HW1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../HW/hw_02_fitting_lm.html" rel="" target="">
 <span class="dropdown-text">HW2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../HW/hw_03_diagnostics.html" rel="" target="">
 <span class="dropdown-text">HW3</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notes" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-notes">    
        <li>
    <a class="dropdown-item" href="../Notes/lab1.html" rel="" target="">
 <span class="dropdown-text">Lab 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Notes/Inference_Diagnostics.html" rel="" target="">
 <span class="dropdown-text">Inference &amp; Diagnostics</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rmk118/ruby-math299" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-3-inference" id="toc-chapter-3-inference" class="nav-link active" data-scroll-target="#chapter-3-inference">Chapter 3: Inference</a>
  <ul class="collapse">
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#permutation-tests" id="toc-permutation-tests" class="nav-link" data-scroll-target="#permutation-tests">Permutation Tests</a>
  <ul class="collapse">
  <li><a href="#overall-model" id="toc-overall-model" class="nav-link" data-scroll-target="#overall-model">Overall model</a></li>
  <li><a href="#single-predictor" id="toc-single-predictor" class="nav-link" data-scroll-target="#single-predictor">Single predictor</a></li>
  </ul></li>
  <li><a href="#confidence-intervals" id="toc-confidence-intervals" class="nav-link" data-scroll-target="#confidence-intervals">Confidence Intervals</a>
  <ul class="collapse">
  <li><a href="#single-parameter" id="toc-single-parameter" class="nav-link" data-scroll-target="#single-parameter">Single parameter</a></li>
  <li><a href="#multiple-parameters" id="toc-multiple-parameters" class="nav-link" data-scroll-target="#multiple-parameters">Multiple parameters</a></li>
  </ul></li>
  <li><a href="#bootstrap-confidence-intervals" id="toc-bootstrap-confidence-intervals" class="nav-link" data-scroll-target="#bootstrap-confidence-intervals">Bootstrap Confidence Intervals</a></li>
  </ul></li>
  <li><a href="#chapter-4-prediction" id="toc-chapter-4-prediction" class="nav-link" data-scroll-target="#chapter-4-prediction">Chapter 4: Prediction</a>
  <ul class="collapse">
  <li><a href="#cis-for-predictions" id="toc-cis-for-predictions" class="nav-link" data-scroll-target="#cis-for-predictions">CIs for predictions</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  <li><a href="#chaption-6-diagnostics" id="toc-chaption-6-diagnostics" class="nav-link" data-scroll-target="#chaption-6-diagnostics">Chaption 6: Diagnostics</a>
  <ul class="collapse">
  <li><a href="#checking-error-assumptions" id="toc-checking-error-assumptions" class="nav-link" data-scroll-target="#checking-error-assumptions">Checking Error Assumptions</a></li>
  <li><a href="#constant-variance" id="toc-constant-variance" class="nav-link" data-scroll-target="#constant-variance">Constant Variance</a>
  <ul class="collapse">
  <li><a href="#normality" id="toc-normality" class="nav-link" data-scroll-target="#normality">6.1.2 - Normality</a></li>
  </ul></li>
  <li><a href="#unusual-observations" id="toc-unusual-observations" class="nav-link" data-scroll-target="#unusual-observations">6.2 - Unusual Observations</a>
  <ul class="collapse">
  <li><a href="#leverages" id="toc-leverages" class="nav-link" data-scroll-target="#leverages">6.2.1 - Leverages</a></li>
  </ul></li>
  <li><a href="#standardized-residuals" id="toc-standardized-residuals" class="nav-link" data-scroll-target="#standardized-residuals">Standardized residuals</a></li>
  <li><a href="#studentized-residuals" id="toc-studentized-residuals" class="nav-link" data-scroll-target="#studentized-residuals">Studentized residuals</a></li>
  <li><a href="#influential-observations" id="toc-influential-observations" class="nav-link" data-scroll-target="#influential-observations">6.2.3 Influential Observations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Inference &amp; Diagnostics</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ruby Krasnow </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of packages required:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"PNWColors"</span>, <span class="st">"janitor"</span>, <span class="st">"faraway"</span>, <span class="st">"broom"</span>, <span class="st">"DHARMa"</span>, <span class="st">"emmeans"</span>, <span class="st">"performance"</span>, <span class="st">"ellipse"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages into session</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(packages, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(packages)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure functions with duplicate names are from the correct package</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>select</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> purrr<span class="sc">::</span>map</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>summarize <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>summarize</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>clean_names <span class="ot">&lt;-</span> janitor<span class="sc">::</span>clean_names</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>margin <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span>margin</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co">#Set seed for pseudo-random number generator, for reproducibility</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>mytheme <span class="ot">&lt;-</span> <span class="fu">theme_light</span>()<span class="sc">+</span> <span class="co">#define custom theme for ggplots</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">r =</span> <span class="dv">10</span>, <span class="at">l =</span> <span class="dv">0</span>)),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">l =</span> <span class="dv">0</span>)),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"gala"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="chapter-3-inference" class="level1">
<h1>Chapter 3: Inference</h1>
<p>Consider a larger model <span class="math inline">\(\Omega\)</span> with <span class="math inline">\(p\)</span> parameters and a smaller model <span class="math inline">\(\omega\)</span> that consists of a subset of <span class="math inline">\(q\)</span> predictors from the <span class="math inline">\(p\)</span> predictors that are in <span class="math inline">\(\Omega\)</span>. The F-statistic used in a hypothesis test comparing the two models is:</p>
<p><span class="math display">\[F = \frac{\left(RSS_\omega -RSS_\Omega\right)/(p-q)}{RSS_\Omega/(n-p)} \]</span></p>
<p>Overall F-test compares to null model: Are any of the predictors useful in predicting the response? Let the full model <span class="math inline">\((\Omega)\)</span> be <span class="math inline">\(y = X \beta + \varepsilon\)</span> where <span class="math inline">\(X\)</span> is a full-rank $ n p$ matrix and the reduced model <span class="math inline">\((\omega)\)</span> be <span class="math inline">\(y = \mu + \varepsilon\)</span>. We estimate <span class="math inline">\(\mu\)</span> by <span class="math inline">\(\bar{y}\)</span>. We write the null hypothesis as: <span class="math display">\[H_0: \beta_1 = \ldots\beta_{p-1}=0 \]</span> RSS for the full model: <span class="math display">\[RSS_\Omega=\left(y-X\hat{\beta} \right)^T\left(y-X\hat{\beta} \right) =\hat{\varepsilon}^T\hat{\varepsilon}\]</span> RSS for the smaller model, in this case called TSS, the total sum of squares corrected for the mean <span class="math display">\[TSS=\left(y-\bar{y} \right)^T\left(y-\bar{y}\right) \]</span> The F-statistic is then <span class="math display">\[\frac{(TSS-RSS_\Omega)/(p-1)}{RSS_\Omega/(n-p)}\]</span></p>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"gala"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> Area <span class="sc">+</span> Elevation <span class="sc">+</span> Nearest <span class="sc">+</span> Scruz <span class="sc">+</span> Adjacent, gala)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>nullmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> <span class="dv">1</span>, gala)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmod, nullmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">24</td>
<td style="text-align: right;">89231.37</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">29</td>
<td style="text-align: right;">381081.37</td>
<td style="text-align: right;">-5</td>
<td style="text-align: right;">-291850</td>
<td style="text-align: right;">15.69941</td>
<td style="text-align: right;">7e-07</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can compute this by hand:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>rss0 <span class="ot">&lt;-</span> <span class="fu">deviance</span>(nullmod)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>rss <span class="ot">&lt;-</span> <span class="fu">deviance</span>(lmod)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df0 <span class="ot">&lt;-</span> <span class="fu">df.residual</span>(nullmod)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">df.residual</span>(lmod)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>fstat <span class="ot">&lt;-</span> ((rss<span class="sc">-</span>rss0)<span class="sc">/</span>(df<span class="sc">-</span>df0))<span class="sc">/</span>(rss<span class="sc">/</span>df)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pf</span>(fstat, df0<span class="sc">-</span>df, df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.837893e-07</code></pre>
</div>
</div>
<section id="testing-1-predictor" class="level4">
<h4 class="anchored" data-anchor-id="testing-1-predictor">Testing 1 predictor</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lmods <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> Elevation <span class="sc">+</span> Nearest <span class="sc">+</span> Scruz <span class="sc">+</span> Adjacent, gala)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmods, lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: right;">93469.08</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: right;">89231.37</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4237.718</td>
<td style="text-align: right;">1.139792</td>
<td style="text-align: right;">0.296318</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumary</span>(lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)  7.068221  19.154198  0.3690 0.7153508
Area        -0.023938   0.022422 -1.0676 0.2963180
Elevation    0.319465   0.053663  5.9532 3.823e-06
Nearest      0.009144   1.054136  0.0087 0.9931506
Scruz       -0.240524   0.215402 -1.1166 0.2752082
Adjacent    -0.074805   0.017700 -4.2262 0.0002971

n = 30, p = 6, Residual SE = 60.97519, R-Squared = 0.77</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumary</span>(<span class="fu">lm</span>(Species <span class="sc">~</span> Area, gala))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept) 63.782861  17.524416  3.6397 0.0010943
Area         0.081963   0.019713  4.1578 0.0002748

n = 30, p = 2, Residual SE = 91.73159, R-Squared = 0.38</code></pre>
</div>
</div>
</section>
<section id="testing-a-pair-of-predictors" class="level4">
<h4 class="anchored" data-anchor-id="testing-a-pair-of-predictors">Testing a pair of predictors</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lmods <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> Elevation <span class="sc">+</span> Nearest <span class="sc">+</span> Scruz, gala)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmods, lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">26</td>
<td style="text-align: right;">158291.63</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: right;">89231.37</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">69060.26</td>
<td style="text-align: right;">9.287352</td>
<td style="text-align: right;">0.0010297</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="testing-a-subspace" class="level4">
<h4 class="anchored" data-anchor-id="testing-a-subspace">Testing a subspace</h4>
<p><span class="math display">\[H_0:\beta_\text{Area}= \beta_\text{Adjacent}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lmods <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> <span class="fu">I</span>(Area<span class="sc">+</span>Adjacent) <span class="sc">+</span> Elevation <span class="sc">+</span> Nearest <span class="sc">+</span> Scruz, gala)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmods, lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: right;">109591.12</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: right;">89231.37</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20359.75</td>
<td style="text-align: right;">5.476035</td>
<td style="text-align: right;">0.0279256</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><span class="math display">\[H_0:\beta_\text{Elevation}= 0.5\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lmods <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> Area<span class="sc">+</span> <span class="fu">offset</span>(<span class="fl">0.5</span><span class="sc">*</span>Elevation) <span class="sc">+</span> Nearest <span class="sc">+</span> Scruz <span class="sc">+</span> Adjacent, gala)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lmods, lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: right;">131312.12</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: right;">89231.37</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">42080.76</td>
<td style="text-align: right;">11.3182</td>
<td style="text-align: right;">0.0025738</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>A simpler way to test such point hypotheses is to use a t-statistic: <span class="math display">\[t = (\hat{\beta}−c)/\text{se}(\hat{\beta})\]</span> where <span class="math inline">\(c\)</span> is the point hypothesis. In this example, the statistic and corresponding p-value are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>b_hat <span class="ot">&lt;-</span> <span class="fu">unname</span>(lmod<span class="sc">$</span>coefficients[<span class="st">"Elevation"</span>])</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>se_b_hat <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmod)<span class="sc">$</span>coef[<span class="st">"Elevation"</span>, <span class="st">"Std. Error"</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>(tstat <span class="ot">&lt;-</span> (b_hat<span class="fl">-0.5</span>)<span class="sc">/</span>se_b_hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3.364253</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>(tstat, <span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002573836</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tstat<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.3182</code></pre>
</div>
</div>
</section>
</section>
<section id="permutation-tests" class="level2">
<h2 class="anchored" data-anchor-id="permutation-tests">Permutation Tests</h2>
<section id="overall-model" class="level3">
<h3 class="anchored" data-anchor-id="overall-model">Overall model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> Nearest <span class="sc">+</span> Scruz, gala)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>lms <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmod)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>lms<span class="sc">$</span>fstatistic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     value      numdf      dendf 
 0.6019558  2.0000000 27.0000000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pf</span>(lms<span class="sc">$</span>fstatistic[<span class="dv">1</span>],lms<span class="sc">$</span>fstatistic[<span class="dv">2</span>],lms<span class="sc">$</span>fstatistic[<span class="dv">3</span>],<span class="at">lower.tail=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    value 
0.5549255 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>nreps <span class="ot">&lt;-</span> <span class="dv">4000</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>fstats <span class="ot">&lt;-</span> <span class="fu">numeric</span>(nreps)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nreps){</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>     lmods <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">sample</span>(Species) <span class="sc">~</span> Nearest<span class="sc">+</span>Scruz , gala)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>     fstats[i] <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmods)<span class="sc">$</span>fstat[<span class="dv">1</span>]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(fstats <span class="sc">&gt;</span> lms<span class="sc">$</span>fstat[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.55825</code></pre>
</div>
</div>
</section>
<section id="single-predictor" class="level3">
<h3 class="anchored" data-anchor-id="single-predictor">Single predictor</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)<span class="sc">$</span>coef[<span class="dv">3</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Estimate Std. Error    t value   Pr(&gt;|t|) 
-0.4406401  0.4025312 -1.0946731  0.2833295 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>tstats <span class="ot">&lt;-</span> <span class="fu">numeric</span>(nreps)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nreps){</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  lmods <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> Nearest<span class="sc">+</span><span class="fu">sample</span>(Scruz), gala)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  tstats[i] <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmods)<span class="sc">$</span>coef[<span class="dv">3</span>,<span class="dv">3</span>]</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(tstats) <span class="sc">&gt;</span> <span class="fu">abs</span>(lms<span class="sc">$</span>coef[<span class="dv">3</span>,<span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.26825</code></pre>
</div>
</div>
</section>
</section>
<section id="confidence-intervals" class="level2">
<h2 class="anchored" data-anchor-id="confidence-intervals">Confidence Intervals</h2>
<section id="single-parameter" class="level3">
<h3 class="anchored" data-anchor-id="single-parameter">Single parameter</h3>
<p><span class="math display">\[\hat{\beta_i}\pm t^{(\alpha/2)}_{n-p}\text{se}(\hat{\beta}) \]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Species <span class="sc">~</span> Area <span class="sc">+</span> Elevation <span class="sc">+</span> Nearest <span class="sc">+</span> Scruz <span class="sc">+</span> Adjacent, gala)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sumary</span>(lmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)  7.068221  19.154198  0.3690 0.7153508
Area        -0.023938   0.022422 -1.0676 0.2963180
Elevation    0.319465   0.053663  5.9532 3.823e-06
Nearest      0.009144   1.054136  0.0087 0.9931506
Scruz       -0.240524   0.215402 -1.1166 0.2752082
Adjacent    -0.074805   0.017700 -4.2262 0.0002971

n = 30, p = 6, Residual SE = 60.97519, R-Squared = 0.77</code></pre>
</div>
</div>
<p>We can construct individual 95% CIs for <span class="math inline">\(\beta_\text{Area}\)</span> for which we need the 2.5% and 97.5% percentiles of the t-distribution with 30−6 = 24 degrees of freedom.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(t_stat<span class="ot">&lt;-</span><span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="dv">30-6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.063899</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>b_hat <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmod)<span class="sc">$</span>coefficients[<span class="st">"Area"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>se_b_hat <span class="ot">&lt;-</span> <span class="fu">summary</span>(lmod)<span class="sc">$</span>coefficients[<span class="st">"Area"</span>, <span class="st">"Std. Error"</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>b_hat <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)<span class="sc">*</span>t_stat<span class="sc">*</span>se_b_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.07021580  0.02233912</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(lmod, <span class="st">"Area"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          2.5 %     97.5 %
Area -0.0702158 0.02233912</code></pre>
</div>
</div>
</section>
<section id="multiple-parameters" class="level3">
<h3 class="anchored" data-anchor-id="multiple-parameters">Multiple parameters</h3>
<p>If you are interested in more than one parameter, you can construct a <span class="math inline">\(100(1−\alpha)\)</span>% confidence region for <span class="math inline">\(\beta\)</span> using: <span class="math display">\[\left(\hat{\beta}-\beta \right)^TX^TX\left(\hat{\beta}-\beta \right) \leq p \hat{\sigma}^2 F^{(\alpha)}_{p, n-p} \]</span> These regions are ellipsoidally shaped. Because these ellipsoids lie in higher dimensions, they cannot easily be visualized except for the two-dimensional case. Let’s see how these compare to the univariate confidence intervals. For example, we can construct the joint 95% confidence region for <span class="math inline">\(\beta_\text{Area}\)</span> and <span class="math inline">\(\beta_\text{Adjacent}\)</span>. We have added the point of the least squares estimates which lies at the center of the ellipse and the univariate confidence intervals for both dimensions as dotted lines:</p>
<p>Using base <code>R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ellipse</span>(lmod,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>)),<span class="at">type=</span><span class="st">"l"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.13</span>,<span class="dv">0</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.09</span>, <span class="fl">0.04</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">coef</span>(lmod)[<span class="dv">2</span>], <span class="fu">coef</span>(lmod)[<span class="dv">6</span>], <span class="at">pch=</span><span class="dv">19</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">confint</span>(lmod)[<span class="dv">2</span>,],<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">confint</span>(lmod)[<span class="dv">6</span>,],<span class="at">lty=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Inference_Diagnostics_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A <code>ggplot</code> version:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot version</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="fu">ellipse</span>(lmod,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Area, <span class="at">y=</span>Adjacent))<span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_point()+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_2d</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">color=</span><span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.13</span>,<span class="dv">0</span>), <span class="at">x=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.09</span>, <span class="fl">0.04</span>))<span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">confint</span>(lmod)[<span class="dv">2</span>,],<span class="at">lty=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">confint</span>(lmod)[<span class="dv">6</span>,],<span class="at">lty=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom=</span><span class="st">"point"</span>, <span class="at">x=</span><span class="fu">coef</span>(lmod)[<span class="dv">2</span>], <span class="at">y=</span><span class="fu">coef</span>(lmod)[<span class="dv">6</span>])<span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  mytheme<span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Inference_Diagnostics_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can determine the outcome of various hypotheses from the plot. The joint hypothesis <span class="math inline">\(H_0 : \beta_\text{Area} = \beta_\text{Adjacent} = 0\)</span> is rejected because the origin does not lie inside the ellipse. The hypothesis <span class="math inline">\(H_0 : \beta_\text{Area} = 0\)</span> is not rejected because zero does lie within the vertical dashed lines, whereas the horizontal dashed lines do not encompass zero and so <span class="math inline">\(H_0: \beta_\text{Adjacent} = 0\)</span> is rejected.</p>
</section>
</section>
<section id="bootstrap-confidence-intervals" class="level2">
<h2 class="anchored" data-anchor-id="bootstrap-confidence-intervals">Bootstrap Confidence Intervals</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="dv">4000</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>coefmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,nb,<span class="dv">6</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>resids <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lmod)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">fitted</span>(lmod)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nb){</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>boot <span class="ot">&lt;-</span> preds <span class="sc">+</span> <span class="fu">sample</span>(resids , <span class="at">rep=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>bmod <span class="ot">&lt;-</span> <span class="fu">update</span>(lmod , boot <span class="sc">~</span> .)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>coefmat[i,] <span class="ot">&lt;-</span> <span class="fu">coef</span>(bmod)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coefmat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Intercept"</span>,<span class="fu">colnames</span>(gala[,<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>]))</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>coefmat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(coefmat)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(coefmat,<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="fu">quantile</span>(x,<span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Intercept        Area Elevation   Nearest      Scruz    Adjacent
2.5%  -25.31406 -0.06236506 0.2310989 -1.716588 -0.6061978 -0.10545278
97.5%  42.69309  0.01807403 0.4207570  2.122722  0.1677720 -0.03979658</code></pre>
</div>
</div>
</section>
</section>
<section id="chapter-4-prediction" class="level1">
<h1>Chapter 4: Prediction</h1>
<p>Given a new set of predictors, <span class="math inline">\(x_0\)</span>, the predicted response is <span class="math display">\[\hat{y_0}=x_0^T \hat{\beta}\]</span></p>
<section id="cis-for-predictions" class="level2">
<h2 class="anchored" data-anchor-id="cis-for-predictions">CIs for predictions</h2>
<p>There are two kinds of predictions made from regression models. One is a predicted mean response and the other is a prediction of a future observation. For example, suppose we have built a regression model that predicts the rental price of houses in a given area based on predictors such as the number of bedrooms and closeness to a major highway. There are two kinds of predictions that can be made for a given <span class="math inline">\(x_0\)</span>:</p>
<ol type="1">
<li><p>Suppose a specific house comes on the market with characteristics <span class="math inline">\(x_0\)</span>. Its rental price will be <span class="math inline">\(x_0^T \beta +\varepsilon\)</span>. Since <span class="math inline">\(E(\varepsilon)=0\)</span>, the predicted price is <span class="math inline">\(x_0^T \hat{\beta}\)</span>, but in assessing the variance of this prediction, we must include the variance of <span class="math inline">\(\varepsilon\)</span>.</p></li>
<li><p>Suppose we ask the question — “What would a house with characteristics <span class="math inline">\(x_0\)</span> rent for on average?” This selling price is <span class="math inline">\(x_0^T \beta\)</span> and is again predicted by <span class="math inline">\(x_0^T \hat{\beta}\)</span>, but now only the variance in <span class="math inline">\(\hat{\beta}\)</span> needs to be taken into account.</p></li>
</ol>
<p>Most times, we will want the first case, which is called “prediction of a future value,” while the second case, called “prediction of the mean response” is less commonly required. We have:</p>
<p><span class="math display">\[\text{var}(x_0^T \hat{\beta})= x_0^T (X^TX)^{-1}x_0\sigma^2\]</span></p>
<p>We assume that the future <span class="math inline">\(\varepsilon\)</span> is independent of <span class="math inline">\(\hat{\beta}\)</span>. So a <span class="math inline">\(100(1-\alpha)\)</span>% CI for a single future response is</p>
<p><span class="math display">\[\hat{y_0}\pm t^{(\alpha/2)}_{n-p}\hat{\sigma}\sqrt{1+x_0^T(X^TX)^{-1}x_0}\]</span></p>
<p>There is a conceptual difference here because previous confidence intervals have been for parameters. Parameters are considered to be fixed but unknown — they are not random under the Frequentist approach we are using here. However, a future observation is a random variable. For this reason, it is better to call this a prediction interval. We are saying there is a 95% chance that the future value falls within this interval whereas it would be incorrect to say that for a parameter.</p>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(fat,<span class="at">package=</span><span class="st">"faraway"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(brozek <span class="sc">~</span> age <span class="sc">+</span> weight <span class="sc">+</span> height <span class="sc">+</span> neck <span class="sc">+</span> chest <span class="sc">+</span> abdom <span class="sc">+</span> hip <span class="sc">+</span> thigh <span class="sc">+</span> knee <span class="sc">+</span> ankle <span class="sc">+</span> biceps <span class="sc">+</span> forearm <span class="sc">+</span> wrist, <span class="at">data=</span>fat)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a> x <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(lmod)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>(x0 <span class="ot">&lt;-</span> <span class="fu">apply</span>(x,<span class="dv">2</span>,median))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age      weight      height        neck       chest 
       1.00       43.00      176.50       70.00       38.00       99.65 
      abdom         hip       thigh        knee       ankle      biceps 
      90.95       99.30       59.00       38.50       22.80       32.05 
    forearm       wrist 
      28.70       18.30 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(y0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(x0<span class="sc">*</span><span class="fu">coef</span>(lmod)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17.49322</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(lmod,<span class="at">new=</span><span class="fu">data.frame</span>(<span class="fu">t</span>(x0)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
17.49322 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(lmod,<span class="at">new=</span><span class="fu">data.frame</span>(<span class="fu">t</span>(x0)),<span class="at">interval=</span><span class="st">"prediction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit     lwr      upr
1 17.49322 9.61783 25.36861</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(lmod,<span class="at">new=</span><span class="fu">data.frame</span>(<span class="fu">t</span>(x0)),<span class="at">interval=</span><span class="st">"confidence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 17.49322 16.94426 18.04219</code></pre>
</div>
</div>
<p><strong>Skipping autoregression section b/c would use explicit ARIMA model or other method of time-series analysis where appropriate</strong></p>
</section>
</section>
<section id="chaption-6-diagnostics" class="level1">
<h1>Chaption 6: Diagnostics</h1>
<p>The estimation of and inference from the regression model depend on several assumptions. These assumptions should be checked using regression diagnostics before using the model in earnest. We divide the potential problems into three categories:</p>
<ul>
<li><strong>Error</strong>: We have assumed that <span class="math inline">\(\varepsilon \sim N(0,\sigma^2I)\)</span> or in words, that the errors are independent, have equal variance and are normally distributed.</li>
<li><strong>Model</strong>: We have assumed that the structural part of the model, <span class="math inline">\(E(y) = X\beta\)</span>, is correct.</li>
<li><strong>Unusual observations</strong>: Sometimes just a few observations do not fit the model. These few observations might change the choice and fit of the model.</li>
</ul>
<section id="checking-error-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="checking-error-assumptions">Checking Error Assumptions</h2>
<p>We wish to check the independence, constant variance and normality of the errors, <span class="math inline">\(\varepsilon\)</span>. The errors are not observable, but we can examine the residuals, <span class="math inline">\(\hat{\varepsilon}\)</span>. These are not interchangeable with the error, as they have somewhat different properties. Recall that <span class="math inline">\(\hat{y}=X(X^TX)^{-1}Xy=Hy\)</span>, where <span class="math inline">\(H\)</span> is the hat matrix, so that <span class="math display">\[\hat{\varepsilon}=y-\hat{y}=(I-H)y=(I-H)X\beta+(I-H)\varepsilon=(I-H)\varepsilon \]</span></p>
<p>Therefore, <span class="math inline">\(\text{var}\hat{\varepsilon} = \text{var} (I-H)\varepsilon = (I-H)\sigma^2\)</span> assuming that <span class="math inline">\(\text{var}\varepsilon= \sigma^2I\)</span>. We see that although the errors may have equal variance and be uncorrelated, the residuals do not.</p>
</section>
<section id="constant-variance" class="level2">
<h2 class="anchored" data-anchor-id="constant-variance">Constant Variance</h2>
<p>Is the variance in the residuals related to some other quantity?</p>
<p>The most useful diagnostic is a plot of <span class="math inline">\(\hat{\varepsilon}\)</span> against <span class="math inline">\(\hat{y}\)</span>. If all is well, you should see constant symmetrical variation (homoscedasticity) in the vertical (<span class="math inline">\(\hat{\varepsilon}\)</span>) direction. Nonlinearity in the structural part of the model can also be detected in this plot.</p>
<section id="normality" class="level3">
<h3 class="anchored" data-anchor-id="normality">6.1.2 - Normality</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(sr <span class="sc">~</span> pop15<span class="sc">+</span>pop75<span class="sc">+</span>dpi<span class="sc">+</span>ddpi,savings)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(lmod),<span class="at">ylab=</span><span class="st">"Residuals"</span>,<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(lmod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Inference_Diagnostics_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(lmod),<span class="at">xlab=</span><span class="st">"Residuals"</span>,<span class="at">main=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Inference_Diagnostics_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(lmod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(lmod)
W = 0.98698, p-value = 0.8524</code></pre>
</div>
</div>
</section>
</section>
<section id="unusual-observations" class="level2">
<h2 class="anchored" data-anchor-id="unusual-observations">6.2 - Unusual Observations</h2>
<ul>
<li><em>Outliers</em>: observations that do not fit the model well</li>
<li><em>Influential observations</em>: observations that change the fit of the model in a substantive manner</li>
<li>A <em>leverage point</em> is extreme in the predictor space. It has the potential to influence the fit, but does not necessarily do so.</li>
</ul>
<section id="leverages" class="level3">
<h3 class="anchored" data-anchor-id="leverages">6.2.1 - Leverages</h3>
<p>Leverages <span class="math inline">\(h_i\)</span> are useful diagnostics that depend only on <span class="math inline">\(X\)</span> and not <span class="math inline">\(y\)</span>.</p>
<p><em>Wikipedia definition that I found helpful</em></p>
<p>The leverage score for the <span class="math inline">\({i}^{th}\)</span> observation <span class="math inline">\(\mathbf{x}_i\)</span> is given as <span class="math display">\[h_{ii}=[H] _{ii}=x_i^\top (X^\top X)^{-1} x_i,\]</span> the <span class="math inline">\({i}^{th}\)</span> diagonal element of the hat (projection) matrix, <span class="math inline">\(H=X (X^\top X)^{-1} X^\top\)</span></p>
<p>Thus the <span class="math inline">\({i}^{th}\)</span> leverage score can be viewed as the ‘weighted’ distance between <span class="math inline">\(x_i\)</span> to the mean of <span class="math inline">\(x_i\)</span>’s. Leverage is closely related to the squared Mahalanobis distance: <span class="math display">\[D^2(x_i)=(x_i-\bar{x})^\top S^{-1}(x_i-\bar{x})\]</span> where <span class="math inline">\(S=X^\top X\)</span> is the estimated covariance matrix of <span class="math inline">\(x_i\)</span>’s.</p>
<p>It can also be interpreted as the degree by which the <span class="math inline">\({i}^{th}\)</span> measured (dependent) value (i.e., <span class="math inline">\(y_i\)</span> influences the <span class="math inline">\({i}^{th}\)</span> fitted (predicted) value (i.e., <span class="math inline">\(\hat{y_i}\)</span>: mathematically,</p>
<p><span class="math display">\[h_{ii}=\frac{\partial\hat{y_i}}{\partial y_i} \]</span></p>
<p><a href="https://bpb-us-e1.wpmucdn.com/blogs.rice.edu/dist/e/8375/files/2017/08/Lecture10-2n22q1q.pdf"><em>Properties of $h_{ii}</em></a> - <span class="math inline">\(0 \leq h_{ii} \leq 1\)</span> - Fixed <span class="math inline">\(i: \sum^n_{j=1} h_{ij}=1\)</span> - <span class="math inline">\(\bar{h}=\sum^n_{i=1}h_{ii}/n=p/n\)</span> - Fixed <span class="math inline">\(i: h_{ii}=\sum^n_{j=1} h_{ij}^2\)</span></p>
<p><span class="math display">\[\text{Var}(\hat{e}_i)=\sigma^2(1-h_i) \]</span></p>
<p>Large <span class="math inline">\(h_i\)</span> lead to small variances of <span class="math inline">\(e_i\)</span> and hence <span class="math inline">\(\hat{y_i}\)</span> tends to <span class="math inline">\(y_i\)</span>.</p>
<p>Traditionally, a leverage point is one that satisfies <span class="math inline">\(h_{ii} \geq 2\bar{h} = \frac{2p}{n}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(sr <span class="sc">~</span> pop15 <span class="sc">+</span> pop75 <span class="sc">+</span> dpi <span class="sc">+</span> ddpi, savings)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>hatv <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(lmod)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hatv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Australia    Austria    Belgium    Bolivia     Brazil     Canada 
0.06771343 0.12038393 0.08748248 0.08947114 0.06955944 0.15840239 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(hatv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">## threshold value for h_i ~= 0.2</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>thv <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">length</span>(<span class="fu">coefficients</span>(lmod)) <span class="sc">/</span> <span class="fu">length</span>(hatv))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="do">## are any h_i &gt; Eh?</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>hatv <span class="sc">&gt;</span> thv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Australia        Austria        Belgium        Bolivia         Brazil 
         FALSE          FALSE          FALSE          FALSE          FALSE 
        Canada          Chile          China       Colombia     Costa Rica 
         FALSE          FALSE          FALSE          FALSE          FALSE 
       Denmark        Ecuador        Finland         France        Germany 
         FALSE          FALSE          FALSE          FALSE          FALSE 
        Greece      Guatamala       Honduras        Iceland          India 
         FALSE          FALSE          FALSE          FALSE          FALSE 
       Ireland          Italy          Japan          Korea     Luxembourg 
          TRUE          FALSE           TRUE          FALSE          FALSE 
         Malta         Norway    Netherlands    New Zealand      Nicaragua 
         FALSE          FALSE          FALSE          FALSE          FALSE 
        Panama       Paraguay           Peru    Philippines       Portugal 
         FALSE          FALSE          FALSE          FALSE          FALSE 
  South Africa South Rhodesia          Spain         Sweden    Switzerland 
         FALSE          FALSE          FALSE          FALSE          FALSE 
        Turkey        Tunisia United Kingdom  United States      Venezuela 
         FALSE          FALSE          FALSE           TRUE          FALSE 
        Zambia        Jamaica        Uruguay          Libya       Malaysia 
         FALSE          FALSE          FALSE           TRUE          FALSE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>hatv[hatv<span class="sc">&gt;</span>thv]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Ireland         Japan United States         Libya 
    0.2122363     0.2233099     0.3336880     0.5314568 </code></pre>
</div>
</div>
<p>We verify that the sum of the leverages is indeed 5 — the number of parameters in the model.</p>
<p>We can also identify high leverages using half-normal plots, where the data are plotted against positive normal quantiles. We do not usually expect a straight line relationship since we do not necessarily expect a positive normal distribution for quantities like leverages. We are looking for outliers, which will be apparent as points that diverge substantially from the rest of the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">row.names</span>(savings)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">halfnorm</span>(hatv,<span class="at">labs=</span>countries,<span class="at">ylab=</span><span class="st">"Leverages"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Inference_Diagnostics_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="standardized-residuals" class="level2">
<h2 class="anchored" data-anchor-id="standardized-residuals">Standardized residuals</h2>
<p>We can use the leverages to scale the residuals so their variance is 1 <span class="math display">\[r_i=\frac{\hat{e_i}}{\sigma \sqrt{1-h_i}} \]</span></p>
<p>Doing so allows for easy examination via <span class="math inline">\(Q-Q\)</span> plots, as values should lie on the 1:1 line.</p>
</section>
<section id="studentized-residuals" class="level2">
<h2 class="anchored" data-anchor-id="studentized-residuals">Studentized residuals</h2>
<p>One way to detect outliers is to estimate <span class="math inline">\(n\)</span> different models where we exclude one data point from each model. <span class="math display">\[\hat{y}_{(i)}=X_{(i)}\hat{\beta}_{(i)}\]</span> where <span class="math inline">\((i)\)</span> indicates that the <span class="math inline">\(i^{th}\)</span> datum has been omitted. If <span class="math inline">\(y_i-\hat{y}_{(i)}\)</span> is large, then observation <span class="math inline">\(i\)</span> is an outlier. To judge the size of a potential outlier, we need an appropriate scaling. We find <span class="math display">\[\widehat{\text{var}}(y_i-\hat{y}_{(i)})=\hat{\sigma}_{(i)}^2 (1+X_{i} (X_{(i)}^\top X_{(i)})^{-1}X_i) \]</span></p>
<p>So we can compute the studentized residuals as <span class="math display">\[t_i = \frac{y_i-\hat{y}_{(i)}}{\hat{\sigma}_{(i)}\sqrt{1+X_{i} (X_{(i)}^\top X_{(i)})^{-1}X_i}} \]</span></p>
<p>which are distributed as a <span class="math inline">\(t\)</span>-distribution with <span class="math inline">\(n-p-1\)</span> df. Fortunately, there is an easier way to compute <span class="math inline">\(t_i\)</span> that avoids doing <span class="math inline">\(n\)</span> regressions: <span class="math display">\[t_i=\frac{\hat{e_i}}{\hat{\sigma}_{(i)} \sqrt{1-h_i}}= r_i \left(\frac{n-p-1}{n-p-r_i^2} \right)^{1/2} \]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>stud <span class="ot">&lt;-</span> <span class="fu">rstudent</span>(lmod)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>stud[<span class="fu">which.max</span>(<span class="fu">abs</span>(stud))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Zambia 
2.853558 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">df.residual</span>(lmod)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qt</span>(<span class="at">p=</span>.<span class="dv">05</span><span class="sc">/</span>(<span class="fu">length</span>(countries)<span class="sc">*</span><span class="dv">2</span>), <span class="at">df=</span>df) <span class="co">#find test statistic, which is greater than the absolute value of the studentized residual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3.525801</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>((<span class="fu">unname</span>(<span class="sc">-</span>stud[<span class="fu">which.max</span>(<span class="fu">abs</span>(stud))])), <span class="at">df=</span>df, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>) <span class="co">#p-value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.006566663</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>((<span class="fu">unname</span>(<span class="sc">-</span>stud[<span class="fu">which.max</span>(<span class="fu">abs</span>(stud))])), <span class="at">df=</span>df, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)<span class="sc">*</span><span class="fu">nrow</span>(savings) <span class="co">#corrected</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3283332</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">outlierTest</span>(lmod) <span class="co">#easier</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No Studentized residuals with Bonferroni p &lt; 0.05
Largest |rstudent|:
       rstudent unadjusted p-value Bonferroni p
Zambia 2.853558          0.0065667      0.32833</code></pre>
</div>
</div>
</section>
<section id="influential-observations" class="level2">
<h2 class="anchored" data-anchor-id="influential-observations">6.2.3 Influential Observations</h2>
<p>An influential point is one whose removal from the dataset would cause a large change in the fit. An influential point may or may not be an outlier and may or may not have large leverage, but it will tend to have at least one of these two properties.</p>
<p>Cook’s D: <span class="math display">\[D_i=\frac{e_i^2}{p} \left(\frac{h_i}{1-h_i} \right) \]</span></p>
<p>This metric combines the residual effect and leverage to quantify the influence. A half-normal plot of <span class="math inline">\(D_i\)</span> can be used to identify influential observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(sr <span class="sc">~</span> pop15<span class="sc">+</span>pop75<span class="sc">+</span>dpi<span class="sc">+</span>ddpi,savings)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>cook <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(lmod)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">halfnorm</span>(cook,<span class="dv">3</span>,<span class="at">labs=</span>countries,<span class="at">ylab=</span><span class="st">"Cook’s distances"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Inference_Diagnostics_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>